# System Tray Design

## 技术方案

### 方案选型

| 方案 | 优点 | 缺点 | 选择 |
|------|------|------|------|
| Wails 内置托盘 API | 官方支持，跨平台 | v2 功能有限 | ✅ |
| 第三方库 (systray) | 成熟稳定 | 额外依赖 | ❌ |
| Windows 原生 API | 功能完整 | 仅限 Windows | ❌ |

**选择理由**：优先使用 Wails 内置 API 保持一致性，v2 虽功能有限但满足基本需求。

### 架构设计

```
┌─────────────────────────────────────────┐
│                  App                     │
│  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │  Tray    │  │  Config  │  │ Window │ │
│  │ Manager  │──│  Store   │  │ Events │ │
│  └──────────┘  └──────────┘  └────────┘ │
└─────────────────────────────────────────┘
```

### 托盘菜单设计

```
[应用图标]
├── 显示主窗口
├── ─────────
├── ✓ 关闭时最小化到托盘
├── ─────────
└── 退出
```

## 配置存储

### 存储方式

使用 JSON 文件存储在用户数据目录：

```
%APPDATA%/WailsDemo/config.json
```

### 配置结构

```go
type Config struct {
    MinimizeToTray bool `json:"minimizeToTray"` // 关闭时最小化到托盘
}
```

**默认值**：
- `MinimizeToTray`: `false`（默认关闭不隐藏到托盘）

## 窗口关闭处理

### 事件流程

```
用户点击 X
    │
    ▼
检查 MinimizeToTray 配置
    │
    ├── true ──▶ 隐藏窗口 (WindowHide)
    │             └── 托盘图标保持
    │
    └── false ─▶ 正常退出 (Quit)
```

### 实现方式

1. 使用 Wails 的 `OnBeforeClose` 钩子拦截关闭事件
2. 根据配置决定隐藏窗口或退出

## 前端集成

### 设置界面

在应用中添加设置选项：

```
┌────────────────────────────┐
│  设置                      │
│                            │
│  □ 关闭时最小化到系统托盘  │
│                            │
└────────────────────────────┘
```

### API 绑定

```go
// 获取托盘设置
func (a *App) GetTraySettings() Config
// 更新托盘设置
func (a *App) SetTraySettings(config Config) error
```

## 开放问题

1. **双击托盘图标**：是否响应双击显示窗口？
   - 建议：是，双击显示主窗口

2. **气泡通知**：隐藏到托盘时是否显示通知？
   - 建议：首次隐藏时显示一次提示

3. **开机启动**：是否一并添加开机自启功能？
   - 建议：作为独立功能，本次不实现
